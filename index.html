<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
:root{--neon:#00e676;--neon-glow:rgba(0,230,118,0.2);--bg:#0a0a0a;--bg-secondary:#121212;--card:#1a1a1a;--card-hover:#202020;--blue:#00e5ff;--blue-glow:rgba(0,229,255,0.2);--red:#ff3d00;--orange:#ff9100;--text-primary:#f0f0f0;--text-secondary:#999;--border:#2a2a2a}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text-primary);line-height:1.6;padding-bottom:80px;-webkit-font-smoothing:antialiased}.login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.login-box{background:var(--card);padding:40px;border-radius:16px;border:2px solid var(--neon);max-width:400px;width:100%}.login-box h2{color:var(--neon);margin-bottom:30px;text-align:center}.nav{display:flex;background:var(--card);position:sticky;top:0;z-index:100;border-bottom:1px solid var(--border);backdrop-filter:blur(10px);box-shadow:0 4px 20px rgba(0,0,0,0.5);overflow-x:auto}.nav button{flex:1;padding:18px 12px;border:none;background:none;color:var(--text-secondary);cursor:pointer;font-size:10px;font-weight:700;min-width:85px;text-transform:uppercase;letter-spacing:0.5px;transition:all 0.3s ease;position:relative}.nav button:hover{background:rgba(0,230,118,0.05);color:var(--neon)}.nav button.active{color:var(--neon)}.nav button.active::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:var(--neon);box-shadow:0 0 10px var(--neon-glow)}.user-info{background:var(--bg-secondary);padding:10px 20px;text-align:right;font-size:12px;color:var(--text-secondary);border-bottom:1px solid var(--border)}.user-info strong{color:var(--neon)}.logout-btn{background:none;border:1px solid var(--red);color:var(--red);padding:4px 12px;border-radius:4px;cursor:pointer;margin-left:10px;font-size:10px}.container{padding:20px;max-width:800px;margin:auto}.panel{display:none;animation:fadeIn 0.3s ease}.panel.active{display:block}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.panel-header h2{font-size:24px;font-weight:700;background:linear-gradient(135deg,var(--neon),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.sync-btn{background:linear-gradient(135deg,var(--card),var(--bg-secondary));color:var(--neon);border:1px solid var(--neon);padding:14px 24px;border-radius:12px;width:100%;font-weight:700;cursor:pointer;margin-bottom:24px;font-size:13px;letter-spacing:1px;text-transform:uppercase;transition:all 0.3s ease;box-shadow:0 0 20px var(--neon-glow)}.sync-btn:hover{background:var(--neon);color:var(--bg);box-shadow:0 0 30px var(--neon-glow);transform:translateY(-2px)}.sync-btn:disabled{opacity:0.5;cursor:not-allowed}.export-btn{background:var(--blue);border:none;padding:8px 16px;border-radius:8px;font-size:11px;font-weight:700;color:var(--bg);cursor:pointer;letter-spacing:0.5px;transition:all 0.3s ease}.export-btn:hover{box-shadow:0 0 20px var(--blue-glow);transform:translateY(-2px)}.save-btn{width:100%;padding:18px;background:linear-gradient(135deg,var(--neon),#00c853);color:var(--bg);border:none;border-radius:12px;font-weight:700;cursor:pointer;font-size:14px;letter-spacing:1px;text-transform:uppercase;transition:all 0.3s ease;box-shadow:0 4px 20px var(--neon-glow);margin-top:8px}.save-btn:hover{box-shadow:0 6px 30px var(--neon-glow);transform:translateY(-2px)}.save-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}.calc-box{background:linear-gradient(135deg,var(--card),var(--bg-secondary));padding:20px;border-radius:16px;border-left:4px solid var(--neon);margin-bottom:16px;transition:all 0.3s ease;position:relative;overflow:hidden}.calc-box:hover{background:var(--card-hover);transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,0.4)}.val{font-size:28px;font-weight:800;letter-spacing:-0.5px;margin-top:8px}.label-sm{font-size:11px;color:var(--text-secondary);text-transform:uppercase;font-weight:700;margin-bottom:8px;letter-spacing:1px;display:block}.stock-row{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:var(--card);border-radius:10px;margin-bottom:8px;font-size:13px;transition:all 0.3s ease;border:1px solid var(--border)}.stock-row:hover{background:var(--card-hover);border-color:var(--neon);transform:translateX(4px)}.stock-row span:last-child{color:var(--neon)}input,select{width:100%;padding:14px 16px;background:var(--card);border:1px solid var(--border);color:var(--text-primary);border-radius:10px;margin-bottom:16px;font-size:14px;font-family:'Inter',sans-serif;transition:all 0.3s ease}input:focus,select:focus{outline:none;border-color:var(--neon);box-shadow:0 0 0 3px var(--neon-glow);background:var(--bg-secondary)}input::placeholder{color:var(--text-secondary)}.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}.section-header{font-size:13px;font-weight:700;color:var(--neon);text-transform:uppercase;letter-spacing:1px;margin:24px 0 12px 0;padding-bottom:8px;border-bottom:2px solid var(--border)}.inventory-table{width:100%;border-collapse:collapse;margin-top:20px}.inventory-table th{background:var(--card);padding:12px;text-align:left;font-size:11px;color:var(--neon);border-bottom:2px solid var(--border)}.inventory-table td{padding:12px;border-bottom:1px solid var(--border);font-size:13px}.inventory-table tr:hover{background:var(--card-hover)}.status-badge{padding:4px 8px;border-radius:4px;font-size:10px;font-weight:700;text-transform:uppercase}.status-available{background:rgba(0,230,118,0.2);color:var(--neon)}.status-sold{background:rgba(255,61,0,0.2);color:var(--red)}.status-processing{background:rgba(0,229,255,0.2);color:var(--blue)}@media (max-width:480px){.container{padding:15px}.nav button{font-size:9px;min-width:70px;padding:15px 8px}.val{font-size:24px}.grid-3{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="loginScreen" class="login-screen">
<div class="login-box">
<h2>üîê Login</h2>
<label class="label-sm">Username</label>
<input type="text" id="loginUsername" placeholder="Enter username">
<label class="label-sm">Password</label>
<input type="password" id="loginPassword" placeholder="Enter password">
<button class="save-btn" onclick="doLogin()">üîì Login</button>
<p style="font-size:11px;color:var(--text-secondary);margin-top:20px;text-align:center">Default: admin/admin or supervisor/supervisor</p>
</div>
</div>
<div id="mainApp" style="display:none">
<div class="user-info"><strong id="currentUser"></strong><button class="logout-btn" onclick="doLogout()">Logout</button></div>
<div class="nav" id="mainNav"></div>
<div class="container">
<div id="setup" class="panel"><div class="calc-box" style="border-left-color:var(--blue)"><h3 style="color:var(--neon);margin-bottom:20px">üöÄ Setup</h3><label class="label-sm">Supabase URL</label><input type="text" id="supabase_url" placeholder="https://xxxxx.supabase.co"><label class="label-sm">Key</label><input type="text" id="supabase_key" placeholder="eyJ..."><button class="save-btn" onclick="testConnection()" style="background:var(--blue);margin-bottom:10px">Test</button><button class="save-btn" onclick="saveSupabaseConfig()">Save</button></div></div>
<div id="summary" class="panel"><button class="sync-btn" onclick="refreshData()">üîÑ Sync</button><div class="calc-box" style="border-left-color:var(--blue)"><div class="label-sm" style="color:var(--blue)">Valuation</div><div id="fac_val" class="val">Rs. 0</div><div class="grid-2" style="margin-top:12px;font-size:12px;gap:20px"><div><span style="color:var(--text-secondary)">CBM:</span> <strong id="total_cbm" style="color:var(--neon)">0</strong></div><div><span style="color:var(--text-secondary)">SQM:</span> <strong id="total_sqm" style="color:var(--neon)">0</strong></div></div></div><div class="calc-box" style="border-left-color:var(--red)"><div class="label-sm" style="color:var(--red)">Shrinkage</div><div class="grid-2" style="font-size:13px;gap:16px"><div><div style="color:var(--text-secondary);font-size:11px">%</div><div id="shrink_percent" style="font-size:20px;font-weight:700;color:var(--red)">0%</div></div><div><div style="color:var(--text-secondary);font-size:11px">SQFT</div><div id="shrink_sqft" style="font-size:20px;font-weight:700;color:var(--red)">0</div></div><div><div style="color:var(--text-secondary);font-size:11px">CBM</div><div id="shrink_cbm" style="font-size:20px;font-weight:700;color:var(--red)">0</div></div><div><div style="color:var(--text-secondary);font-size:11px">SQM</div><div id="shrink_sqm" style="font-size:20px;font-weight:700;color:var(--red)">0</div></div></div></div><div class="section-header">Lots</div><div id="lot_grid"></div></div>
<div id="inventory" class="panel"><div class="panel-header"><h2>Inventory</h2><button class="export-btn" onclick="alert('Export coming soon')">Excel</button></div><div class="calc-box" style="border-left-color:var(--orange)"><div class="label-sm">Stock</div><div id="inv_total_sqft" class="val">0 SQFT</div><div id="inv_total_count" style="font-size:12px;color:var(--text-secondary);margin-top:4px">0 Slabs</div></div><div id="inventory_classification"></div><div class="section-header">All Slabs</div><div id="all_slabs_list"></div></div>
<div id="sales" class="panel"><div class="panel-header"><h2>Sales</h2></div><label class="label-sm">Slab</label><select id="sale_slab_list" onchange="updateSaleFields()"></select><label class="label-sm">Customer</label><input type="text" id="sale_customer" placeholder="Name"><div class="grid-3"><div><label class="label-sm">Length (cm)</label><input type="number" id="sale_length_cm" readonly style="background:var(--bg-secondary)"></div><div><label class="label-sm">Height (cm)</label><input type="number" id="sale_height_cm" readonly style="background:var(--bg-secondary)"></div><div><label class="label-sm">Thick</label><input type="text" id="sale_thickness" readonly style="background:var(--bg-secondary)"></div></div><div class="grid-2"><div><label class="label-sm">Original SQFT</label><input type="number" id="sale_original_sqft" readonly style="background:var(--bg-secondary)"></div><div><label class="label-sm">Sold SQFT</label><input type="number" id="sale_sold_sqft" placeholder="Actual" oninput="updateSaleSummary()"></div></div><label class="label-sm">Price/SQFT</label><input type="number" id="sale_price_sqft" placeholder="0.00" oninput="updateSaleSummary()"><div class="calc-box" style="border-left-color:var(--blue);margin-top:20px"><div class="label-sm">Summary</div><div id="sale_summary" style="font-size:14px;color:var(--text-secondary)">Fill details</div></div><button class="save-btn" onclick="recordSale()">Record</button><div class="section-header">History</div><div id="sales_history"></div></div>
<div id="waste" class="panel"><div class="panel-header"><h2>Waste Sales</h2></div><div class="calc-box" style="border-left-color:var(--orange)"><div class="label-sm">Bulk/Weight Sale</div><label class="label-sm">Date</label><input type="date" id="waste_date"><label class="label-sm">Description</label><input type="text" id="waste_desc" placeholder="Monthly waste, Class 2"><div class="grid-2"><div><label class="label-sm">Weight (KG)</label><input type="number" id="waste_weight" placeholder="0" oninput="calculateWasteValue()"></div><div><label class="label-sm">Price/KG</label><input type="number" id="waste_price" placeholder="0.00" oninput="calculateWasteValue()"></div></div><label class="label-sm">Buyer</label><input type="text" id="waste_buyer" placeholder="Name"><div id="waste_total" style="font-size:20px;font-weight:700;color:var(--neon);margin:12px 0">Total: Rs. 0</div><button class="save-btn" onclick="saveWasteSale()">Record</button></div><div class="section-header">History</div><div id="waste_history"></div></div>
<div id="reports" class="panel"><div class="panel-header"><h2>P&L</h2><button class="export-btn" onclick="alert('Export coming soon')">Export</button></div><div class="calc-box" style="border-left-color:var(--neon)"><div class="label-sm" style="color:var(--neon)">Summary</div><div class="grid-2" style="margin-top:12px;gap:20px"><div><div style="font-size:11px;color:var(--text-secondary)">Investment</div><div id="pl_total_investment" style="font-size:20px;font-weight:700;color:var(--orange)">Rs. 0</div></div><div><div style="font-size:11px;color:var(--text-secondary)">Revenue</div><div id="pl_total_revenue" style="font-size:20px;font-weight:700;color:var(--blue)">Rs. 0</div></div><div><div style="font-size:11px;color:var(--text-secondary)">Net P/L</div><div id="pl_net_profit" style="font-size:24px;font-weight:800">Rs. 0</div></div><div><div style="font-size:11px;color:var(--text-secondary)">ROI</div><div id="pl_profit_margin" style="font-size:20px;font-weight:700">0%</div></div></div></div><div class="section-header">Lot P&L</div><div id="lot_pl_breakdown"></div></div><div id="mass" class="panel"><div class="panel-header"><h2>Register Lot</h2></div><label class="label-sm">Lot ID</label><input type="text" id="m_lot" placeholder="LOT-001"><label class="label-sm">Cost (Lakhs)</label><input type="number" id="m_cost" placeholder="0.00" step="0.01"><button class="save-btn" onclick="saveMass()">Register</button></div>
<div id="block" class="panel"><div class="panel-header"><h2>Add Block</h2></div><label class="label-sm">Select Lot</label><select id="b_lot_list"></select><label class="label-sm">Block ID</label><input type="text" id="b_id" placeholder="BLOCK-001"><label class="label-sm">Lengths (cm)</label><div class="grid-2"><input type="number" class="b_l" placeholder="L1"><input type="number" class="b_l" placeholder="L2"><input type="number" class="b_l" placeholder="L3"><input type="number" class="b_l" placeholder="L4"></div><label class="label-sm">Heights (cm)</label><div class="grid-2"><input type="number" class="b_h" placeholder="H1"><input type="number" class="b_h" placeholder="H2"><input type="number" class="b_h" placeholder="H3"><input type="number" class="b_h" placeholder="H4"></div><label class="label-sm">Widths (cm)</label><div class="grid-2"><input type="number" class="b_w" placeholder="W1"><input type="number" class="b_w" placeholder="W2"><input type="number" class="b_w" placeholder="W3"><input type="number" class="b_w" placeholder="W4"></div><button class="save-btn" onclick="saveBlock()">Save</button><div class="section-header">Active Blocks</div><div id="active_blocks_list"></div></div>
<div id="slab" class="panel"><div class="panel-header"><h2>Cut Slab</h2></div><label class="label-sm">Block (Last: <span id="last_block_info">None</span>)</label><select id="s_block_list" onchange="saveLastBlock()"></select><label class="label-sm">Slab Number</label><input type="text" id="s_slab_number" placeholder="SLAB-001"><label class="label-sm">Thickness</label><select id="s_thick"><option value="2cm">2 cm</option><option value="3cm">3 cm</option></select><label class="label-sm">Dimensions</label><div class="grid-2"><div><input type="number" id="s_l_cm" placeholder="Length (cm)" oninput="convertToInches('cut')"><div style="font-size:10px;color:var(--text-secondary);margin-top:-12px;margin-bottom:12px"><span id="s_l_in">0</span> inches</div></div><div><input type="number" id="s_h_cm" placeholder="Height (cm)" oninput="convertToInches('cut')"><div style="font-size:10px;color:var(--text-secondary);margin-top:-12px;margin-bottom:12px"><span id="s_h_in">0</span> inches</div></div></div><button class="save-btn" onclick="saveSlab()">Save</button><div class="section-header">Progress</div><div id="blocks_progress"></div></div>
<div id="polish" class="panel"><div class="panel-header"><h2>Polish</h2></div><label class="label-sm">Raw Slab</label><select id="p_slab_list" onchange="autoFillPolishDimensions()"></select><div class="calc-box" style="border-left-color:var(--orange);margin-bottom:16px"><div class="label-sm">Original</div><div id="original_dimensions">Select slab</div></div><label class="label-sm">Net Dimensions (cm)</label><div class="grid-2"><div><input type="number" id="p_l_cm" placeholder="Length" step="0.1" oninput="convertToInches('polish')"><div style="font-size:10px;color:var(--text-secondary);margin-top:-12px;margin-bottom:12px"><span id="p_l_in">0</span> inches</div></div><div><input type="number" id="p_h_cm" placeholder="Height" step="0.1" oninput="convertToInches('polish')"><div style="font-size:10px;color:var(--text-secondary);margin-top:-12px;margin-bottom:12px"><span id="p_h_in">0</span> inches</div></div></div><label class="label-sm">Quality</label><select id="p_q"></select><button class="save-btn" onclick="savePolish()">Finalize</button></div>
<div id="users" class="panel"><div class="panel-header"><h2>Users</h2></div><div class="calc-box" style="border-left-color:var(--blue)"><div class="label-sm">Add User</div><label class="label-sm">Username</label><input type="text" id="new_username" placeholder="username"><label class="label-sm">Password</label><input type="text" id="new_password" placeholder="password"><label class="label-sm">Role</label><select id="new_role"><option value="admin">Admin</option><option value="supervisor">Supervisor</option></select><button class="save-btn" onclick="addUser()">Add</button></div><div class="section-header">All Users</div><div id="users_list"></div></div>
</div></div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
let supabaseClient=null,currentUser=null,currentRole=null;const SUPABASE_URL='YOUR_SUPABASE_URL_HERE',SUPABASE_KEY='YOUR_SUPABASE_KEY_HERE';const menuConfig={admin:['summary','inventory','sales','waste','reports','mass','block','slab','polish','users'],supervisor:['summary','inventory','mass','block','slab','polish']},menuNames={summary:'Dashboard',inventory:'Inventory',sales:'Sales',waste:'Waste',reports:'P&L',mass:'Lot',block:'Block',slab:'Cut',polish:'Polish',users:'Users'};window.addEventListener('load',initApp);function initApp(){const config=JSON.parse(localStorage.getItem('supabase_config')||'{}'),session=JSON.parse(localStorage.getItem('user_session')||'{}');if(typeof window.supabase==='undefined'){alert('Supabase library failed');return}let url=SUPABASE_URL,key=SUPABASE_KEY;if(url==='YOUR_SUPABASE_URL_HERE'){url=config.url;key=config.key}if(!url||!key){document.getElementById('loginScreen').style.display='none';document.getElementById('mainApp').style.display='block';document.querySelectorAll('.panel').forEach(p=>p.style.display='none');document.getElementById('setup').style.display='block';return}supabaseClient=window.supabase.createClient(url,key);if(session.role){currentUser=session.user;currentRole=session.role;showMainApp()}else{document.getElementById('loginScreen').style.display='flex';document.getElementById('mainApp').style.display='none'}}async function doLogin(){const username=document.getElementById('loginUsername').value.trim(),password=document.getElementById('loginPassword').value;if(!username||!password){alert('Enter credentials');return}if(!supabaseClient){alert('Database not configured');return}try{const{data:users,error}=await supabaseClient.from('users').select('*').eq('username',username).eq('password',password).single();if(error||!users){alert('Invalid credentials');return}currentUser=username;currentRole=users.role;localStorage.setItem('user_session',JSON.stringify({user:currentUser,role:currentRole,userId:users.id}));showMainApp()}catch(error){alert('Login failed: '+error.message)}}function doLogout(){localStorage.removeItem('user_session');location.reload()}function showMainApp(){document.getElementById('loginScreen').style.display='none';document.getElementById('mainApp').style.display='block';document.getElementById('currentUser').textContent=currentUser+' ('+(currentRole==='admin'?'Admin':'Supervisor')+')';const nav=document.getElementById('mainNav');nav.innerHTML='';menuConfig[currentRole].forEach((panelId,index)=>{const btn=document.createElement('button');btn.textContent=menuNames[panelId];btn.onclick=()=>showPanel(panelId,btn);if(index===0)btn.classList.add('active');nav.appendChild(btn)});showPanel(menuConfig[currentRole][0],nav.firstChild);refreshData();loadQualityGrades();loadLastBlock();if(currentRole==='admin'){refreshUsers()}}function showPanel(id,btn){document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));document.getElementById(id).classList.add('active');if(btn)btn.classList.add('active')}function saveSupabaseConfig(){const url=document.getElementById('supabase_url').value.trim(),key=document.getElementById('supabase_key').value.trim();if(!url||!key){alert('Enter both');return}localStorage.setItem('supabase_config',JSON.stringify({url,key}));alert('Saved! Refreshing...');setTimeout(()=>location.reload(),500)}async function testConnection(){const url=document.getElementById('supabase_url').value.trim(),key=document.getElementById('supabase_key').value.trim();if(!url||!key){alert('Enter credentials');return}try{const testClient=window.supabase.createClient(url,key);const{error}=await testClient.from('lots').select('count');if(error&&error.code==='42P01'){alert('‚úÖ Connected! Run SQL')}else if(error){alert('‚ùå Failed: '+error.message)}else{alert('‚úÖ Connected!')}}catch(error){alert('‚ùå Failed: '+error.message)}}async function refreshData(){if(!supabaseClient)return;const btn=document.querySelector('.sync-btn');if(btn){btn.innerText="‚è≥ Syncing...";btn.disabled=true}try{const{data:lots}=await supabaseClient.from('lots').select('*');const{data:blocks}=await supabaseClient.from('blocks').select('*');const{data:slabs}=await supabaseClient.from('slabs').select('*');const{data:sales}=await supabaseClient.from('sales').select('*');const{data:wasteSales}=await supabaseClient.from('waste_sales').select('*');const lotAnalysis={},blockToLotMap={},factoryTotal={invest:0,currentVal:0,netSqft:0,grossSqft:0,count:0,totalCBM:0};const inventoryByQuality={};(lots||[]).forEach(lot=>{lotAnalysis[lot.lot_id]={invest:parseFloat(lot.cost)*100000,cbm:0,rawSqft:0,netSqft:0,value:0};factoryTotal.invest+=lotAnalysis[lot.lot_id].invest});(blocks||[]).forEach(block=>{const key=`${block.lot_id}-${block.block_id}`;blockToLotMap[key]=block.lot_id;const cbm=parseFloat(block.volume||0);if(lotAnalysis[block.lot_id]){lotAnalysis[block.lot_id].cbm+=cbm}factoryTotal.totalCBM+=cbm});const availableSlabs=[];(slabs||[]).forEach(slab=>{const lotId=blockToLotMap[slab.block_id];const sqft=parseFloat(slab.sqft||0);if(slab.status==='POLISHED'&&lotId&&lotAnalysis[lotId]){const isSold=(sales||[]).some(s=>s.slab_id===slab.id);if(!isSold){availableSlabs.push(slab);const rate=parseInt(slab.rate||75);const thickness=slab.thickness||'2cm';const quality=getQualityName(rate,thickness);if(!inventoryByQuality[quality]){inventoryByQuality[quality]={count:0,sqft:0}}inventoryByQuality[quality].count++;inventoryByQuality[quality].sqft+=sqft}lotAnalysis[lotId].netSqft+=sqft;lotAnalysis[lotId].value+=parseFloat(slab.value||0);factoryTotal.currentVal+=parseFloat(slab.value||0);factoryTotal.netSqft+=sqft;factoryTotal.count++}else if(lotId&&lotAnalysis[lotId]){lotAnalysis[lotId].rawSqft+=sqft;factoryTotal.grossSqft+=sqft}});const shrinkSqft=factoryTotal.grossSqft-factoryTotal.netSqft;const shrinkPercent=factoryTotal.grossSqft>0?(shrinkSqft/factoryTotal.grossSqft*100).toFixed(1):0;const shrinkCBM=(shrinkSqft/10.764*0.02).toFixed(2);const shrinkSQM=(shrinkSqft/10.764).toFixed(2);document.getElementById('fac_val').innerText="Rs. "+factoryTotal.currentVal.toLocaleString('en-IN');document.getElementById('total_cbm').innerText=factoryTotal.totalCBM.toFixed(2)+" m¬≥";document.getElementById('total_sqm').innerText=(factoryTotal.netSqft/10.764).toFixed(2)+" m¬≤";document.getElementById('shrink_percent').innerText=shrinkPercent+"%";document.getElementById('shrink_sqft').innerText=shrinkSqft.toFixed(0);document.getElementById('shrink_cbm').innerText=shrinkCBM;document.getElementById('shrink_sqm').innerText=shrinkSQM;let lotHtml="";for(let id in lotAnalysis){const d=lotAnalysis[id];const pl=d.value-d.invest;const shrink=d.rawSqft>0?((d.rawSqft-d.netSqft)/d.rawSqft*100).toFixed(1):0;const plColor=pl>=0?'var(--neon)':'var(--red)';const lot=(lots||[]).find(l=>l.lot_id===id);const isActive=lot&&lot.status==='ACTIVE';const statusBadge=isActive?'<span class="status-badge status-available">ACTIVE</span>':'<span class="status-badge status-sold">DONE</span>';lotHtml+=`<div class="calc-box" style="border-left-color:${plColor}"><div style="display:flex;justify-content:space-between"><div style="flex:1"><div class="label-sm" style="color:${plColor}">${id} ${statusBadge}</div><div style="font-size:18px;font-weight:700;color:${plColor};margin:8px 0">${pl>=0?'+':''}Rs. ${pl.toLocaleString('en-IN')}</div><div style="font-size:11px;color:var(--text-secondary)">Shrink: ${shrink}% | CBM: ${d.cbm.toFixed(2)} m¬≥</div></div>${isActive?`<button onclick="completeLot('${id}')" style="background:var(--neon);border:none;padding:8px 16px;border-radius:8px;color:#000;cursor:pointer;font-size:11px;font-weight:700;margin-left:10px">Complete</button>`:''}</div></div>`}document.getElementById('lot_grid').innerHTML=lotHtml||'<div style="text-align:center;padding:40px;color:var(--text-secondary)">No lots</div>';document.getElementById('inv_total_sqft').innerText=factoryTotal.netSqft.toFixed(0)+" SQFT";document.getElementById('inv_total_count').innerText=availableSlabs.length+" Slabs";let invHtml="";for(let quality in inventoryByQuality){const data=inventoryByQuality[quality];invHtml+=`<div class="section-header">${quality}</div>`;invHtml+=`<div class="stock-row"><span>${data.count} slabs</span><span style="font-weight:700">${data.sqft.toFixed(0)} sqft</span></div>`}document.getElementById('inventory_classification').innerHTML=invHtml||'<div style="text-align:center;padding:40px;color:var(--text-secondary)">No inventory</div>';let allSlabsHtml='<table class="inventory-table"><tr><th>Slab</th><th>Block</th><th>Status</th><th>Dims (cm)</th><th>SQFT</th><th>Quality</th></tr>';(slabs||[]).forEach(slab=>{const isSold=(sales||[]).some(s=>s.slab_id===slab.id);const quality=slab.rate?getQualityName(slab.rate,slab.thickness):'Raw';allSlabsHtml+=`<tr><td>${slab.slab_number||slab.id}</td><td>${slab.block_id}</td><td><span class="status-badge ${isSold?'status-sold':'status-available'}">${isSold?'SOLD':slab.status}</span></td><td>${slab.length_cm||'-'} √ó ${slab.height_cm||'-'}</td><td>${slab.sqft}</td><td>${quality}</td></tr>`});allSlabsHtml+='</table>';document.getElementById('all_slabs_list').innerHTML=allSlabsHtml;document.getElementById('b_lot_list').innerHTML=(lots||[]).filter(l=>l.status==='ACTIVE').map(l=>`<option value="${l.lot_id}">${l.lot_id}</option>`).join('')||'<option>No lots</option>';document.getElementById('s_block_list').innerHTML=(blocks||[]).filter(b=>b.status==='ACTIVE'||b.processing_status==='PROCESSING').map(b=>{const status=b.processing_status==='PROCESSING'?' (Processing)':'';return`<option value="${b.lot_id}-${b.block_id}">${b.lot_id}-${b.block_id}${status}</option>`}).join('')||'<option>No blocks</option>';let activeBlocksHtml='';const activeBlocks=(blocks||[]).filter(b=>b.status==='ACTIVE');if(activeBlocks.length>0){activeBlocksHtml='<table class="inventory-table"><tr><th>Block</th><th>Lot</th><th>Status</th><th>Action</th></tr>';activeBlocks.forEach(block=>{const statusBadge=block.processing_status==='PROCESSING'?'<span class="status-badge status-processing">CUTTING</span>':'<span class="status-badge status-available">READY</span>';activeBlocksHtml+=`<tr><td>${block.block_id}</td><td>${block.lot_id}</td><td>${statusBadge}</td><td><button onclick="completeBlock('${block.lot_id}','${block.block_id}')" style="background:var(--neon);border:none;padding:6px 12px;border-radius:4px;color:#000;cursor:pointer;font-size:11px;font-weight:700">Complete</button></td></tr>`});activeBlocksHtml+='</table>'}else{activeBlocksHtml='<div style="text-align:center;padding:40px;color:var(--text-secondary)">No blocks</div>'}document.getElementById('active_blocks_list').innerHTML=activeBlocksHtml;let progressHtml='';activeBlocks.forEach(block=>{const blockKey=`${block.lot_id}-${block.block_id}`;const slabCount=(slabs||[]).filter(s=>s.block_id===blockKey).length;progressHtml+=`<div class="calc-box" style="border-left-color:var(--blue)"><div style="display:flex;justify-content:space-between"><div><div class="label-sm">${blockKey}</div><div style="font-size:16px;font-weight:700">${slabCount} slabs</div></div><button onclick="completeBlock('${block.lot_id}','${block.block_id}')" style="background:var(--neon);border:none;padding:8px 16px;border-radius:8px;color:#000;cursor:pointer;font-size:11px;font-weight:700">Complete</button></div></div>`});document.getElementById('blocks_progress').innerHTML=progressHtml||'<div style="text-align:center;padding:40px;color:var(--text-secondary)">No blocks</div>';const rawSlabs=(slabs||[]).filter(s=>s.status==='RAW');document.getElementById('p_slab_list').innerHTML=rawSlabs.map(s=>`<option value="${s.id}">${s.slab_number||s.id} | ${s.block_id}</option>`).join('')||'<option>No slabs</option>';document.getElementById('sale_slab_list').innerHTML='<option value="">Select...</option>'+availableSlabs.map(s=>{const quality=getQualityName(s.rate,s.thickness);return`<option value="${s.id}" data-sqft="${s.sqft}" data-lcm="${s.length_cm}" data-hcm="${s.height_cm}" data-thick="${s.thickness}">${s.slab_number||s.id} | ${quality} | ${s.sqft} sqft</option>`}).join('');if(sales&&sales.length>0){let salesHtml='<table class="inventory-table"><tr><th>Slab</th><th>Customer</th><th>Dims (cm)</th><th>SQFT</th><th>Value</th></tr>';sales.forEach(sale=>{salesHtml+=`<tr><td>${sale.slab_number}</td><td>${sale.customer_name}</td><td>${sale.length_cm} √ó ${sale.height_cm}</td><td>${sale.sold_sqft}</td><td style="color:var(--neon)">Rs. ${parseFloat(sale.total_value).toLocaleString('en-IN')}</td></tr>`});salesHtml+='</table>';document.getElementById('sales_history').innerHTML=salesHtml}else{document.getElementById('sales_history').innerHTML='<div style="text-align:center;padding:40px;color:var(--text-secondary)">No sales</div>'}if(wasteSales&&wasteSales.length>0){let wasteHtml='<table class="inventory-table"><tr><th>Date</th><th>Description</th><th>Weight (KG)</th><th>Price/KG</th><th>Value</th></tr>';wasteSales.forEach(ws=>{wasteHtml+=`<tr><td>${new Date(ws.sale_date).toLocaleDateString()}</td><td>${ws.description||'-'}</td><td>${ws.weight_kg}</td><td>Rs. ${ws.price_per_kg}</td><td style="color:var(--neon)">Rs. ${parseFloat(ws.total_value).toLocaleString('en-IN')}</td></tr>`});wasteHtml+='</table>';document.getElementById('waste_history').innerHTML=wasteHtml}else{document.getElementById('waste_history').innerHTML='<div style="text-align:center;padding:40px;color:var(--text-secondary)">No waste sales</div>'}updatePLReport(lots,sales,wasteSales)}catch(error){console.error('Error:',error);alert('Error: '+error.message)}finally{if(btn){btn.innerText="üîÑ Sync";btn.disabled=false}}}function getQualityName(rate,thickness){const grades=JSON.parse(localStorage.getItem('quality_grades')||JSON.stringify([{name:'Premium 2cm',rate:150,thickness:'2cm'},{name:'Premium 3cm',rate:200,thickness:'3cm'},{name:'Standard 2cm',rate:100,thickness:'2cm'},{name:'Standard 3cm',rate:130,thickness:'3cm'},{name:'Commercial',rate:75,thickness:'2cm'}]));const match=grades.find(g=>g.rate==rate&&g.thickness===thickness);return match?match.name:`Quality ${rate}`}function updatePLReport(lots,sales,wasteSales){let totalInvestment=0,totalRevenue=0;(lots||[]).forEach(lot=>{totalInvestment+=parseFloat(lot.cost)*100000});(sales||[]).forEach(sale=>{totalRevenue+=parseFloat(sale.total_value)});(wasteSales||[]).forEach(ws=>{totalRevenue+=parseFloat(ws.total_value)});const netProfit=totalRevenue-totalInvestment;const roi=totalInvestment>0?((netProfit/totalInvestment)*100).toFixed(2):0;const profitColor=netProfit>=0?'var(--neon)':'var(--red)';document.getElementById('pl_total_investment').innerText='Rs. '+totalInvestment.toLocaleString('en-IN');document.getElementById('pl_total_revenue').innerText='Rs. '+totalRevenue.toLocaleString('en-IN');document.getElementById('pl_net_profit').innerText=(netProfit>=0?'+ ':'- ')+'Rs. '+Math.abs(netProfit).toLocaleString('en-IN');document.getElementById('pl_net_profit').style.color=profitColor;document.getElementById('pl_profit_margin').innerText=roi+'%';document.getElementById('pl_profit_margin').style.color=profitColor;let lotBreakdownHtml='<table class="inventory-table"><tr><th>Lot</th><th>Investment</th><th>Revenue</th><th>P/L</th><th>ROI</th></tr>';(lots||[]).forEach(lot=>{const investment=parseFloat(lot.cost)*100000;const revenue=(sales||[]).filter(s=>s.lot_id===lot.lot_id).reduce((sum,s)=>sum+parseFloat(s.total_value),0);const profit=revenue-investment;const lotROI=investment>0?((profit/investment)*100).toFixed(1):0;const pColor=profit>=0?'var(--neon)':'var(--red)';lotBreakdownHtml+=`<tr><td>${lot.lot_id}</td><td>Rs. ${investment.toLocaleString('en-IN')}</td><td style="color:var(--blue)">Rs. ${revenue.toLocaleString('en-IN')}</td><td style="color:${pColor};font-weight:700">${profit>=0?'+':''}Rs. ${profit.toLocaleString('en-IN')}</td><td style="color:${pColor}">${lotROI}%</td></tr>`});lotBreakdownHtml+='</table>';document.getElementById('lot_pl_breakdown').innerHTML=lotBreakdownHtml}function convertToInches(mode){if(mode==='cut'){const lcm=parseFloat(document.getElementById('s_l_cm').value)||0;const hcm=parseFloat(document.getElementById('s_h_cm').value)||0;document.getElementById('s_l_in').innerText=(lcm/2.54).toFixed(2);document.getElementById('s_h_in').innerText=(hcm/2.54).toFixed(2)}else{const lcm=parseFloat(document.getElementById('p_l_cm').value)||0;const hcm=parseFloat(document.getElementById('p_h_cm').value)||0;document.getElementById('p_l_in').innerText=(lcm/2.54).toFixed(2);document.getElementById('p_h_in').innerText=(hcm/2.54).toFixed(2)}}function saveLastBlock(){const block=document.getElementById('s_block_list').value;localStorage.setItem('last_block',block);document.getElementById('last_block_info').innerText=block}function loadLastBlock(){const lastBlock=localStorage.getItem('last_block');if(lastBlock){const select=document.getElementById('s_block_list');if(select){select.value=lastBlock;document.getElementById('last_block_info').innerText=lastBlock}}}async function saveMass(){if(!supabaseClient)return;const lot=document.getElementById('m_lot').value.trim();const cost=parseFloat(document.getElementById('m_cost').value);if(!lot||!cost){alert('Fill all');return}try{const{error}=await supabaseClient.from('lots').insert([{lot_id:lot,cost:cost,status:'ACTIVE'}]);if(error)throw error;document.getElementById('m_lot').value='';document.getElementById('m_cost').value='';await refreshData();alert('Lot registered!')}catch(error){alert('Error: '+error.message)}}async function saveBlock(){if(!supabaseClient)return;const getMin=(cls)=>{const v=Array.from(document.getElementsByClassName(cls)).map(i=>parseFloat(i.value)).filter(v=>v>0);return v.length?Math.min(...v):0};const l=getMin('b_l');const h=getMin('b_h');const w=getMin('b_w');const lotId=document.getElementById('b_lot_list').value;const blockId=document.getElementById('b_id').value.trim();if(!l||!h||!w||!blockId){alert('Fill all');return}const v=(l*h*w)/1000000;try{const{error}=await supabaseClient.from('blocks').insert([{lot_id:lotId,block_id:blockId,length:l,width:w,height:h,volume:v.toFixed(3),status:'ACTIVE',processing_status:'READY'}]);if(error)throw error;document.getElementById('b_id').value='';document.querySelectorAll('.b_l, .b_h, .b_w').forEach(i=>i.value='');await refreshData();alert('Block saved!')}catch(error){alert('Error: '+error.message)}}async function saveSlab(){if(!supabaseClient)return;const lcm=parseFloat(document.getElementById('s_l_cm').value);const hcm=parseFloat(document.getElementById('s_h_cm').value);const blockId=document.getElementById('s_block_list').value;const thickness=document.getElementById('s_thick').value;const slabNumber=document.getElementById('s_slab_number').value.trim();if(!lcm||!hcm||!slabNumber){alert('Fill all');return}const lin=lcm/2.54;const hin=hcm/2.54;const sq=(lin*hin)/144;try{const[lotId,blockIdOnly]=blockId.split('-');await supabaseClient.from('blocks').update({processing_status:'PROCESSING'}).eq('lot_id',lotId).eq('block_id',blockIdOnly);const{error}=await supabaseClient.from('slabs').insert([{block_id:blockId,slab_number:slabNumber,status:'RAW',length:lin.toFixed(2),height:hin.toFixed(2),length_cm:lcm,height_cm:hcm,sqft:sq.toFixed(2),thickness:thickness,rate:null,value:null}]);if(error)throw error;document.getElementById('s_l_cm').value='';document.getElementById('s_h_cm').value='';document.getElementById('s_slab_number').value='';document.getElementById('s_l_in').innerText='0';document.getElementById('s_h_in').innerText='0';await refreshData();alert('Cut saved!')}catch(error){alert('Error: '+error.message)}}async function autoFillPolishDimensions(){const slabId=document.getElementById('p_slab_list').value;if(!slabId||!supabaseClient)return;try{const{data:slab}=await supabaseClient.from('slabs').select('*').eq('id',slabId).single();if(slab){document.getElementById('p_l_cm').value=slab.length_cm||'';document.getElementById('p_h_cm').value=slab.height_cm||'';convertToInches('polish');document.getElementById('original_dimensions').innerHTML=`Original: <strong>${slab.length_cm} √ó ${slab.height_cm} cm</strong> = ${slab.sqft} sqft<br><span style="color:var(--orange);font-size:12px">Adjust if trimmed</span>`}}catch(error){console.error('Error:',error)}}async function savePolish(){if(!supabaseClient)return;const lcm=parseFloat(document.getElementById('p_l_cm').value);const hcm=parseFloat(document.getElementById('p_h_cm').value);const rate=parseFloat(document.getElementById('p_q').value);const rawSlabId=document.getElementById('p_slab_list').value;if(!lcm||!hcm||!rawSlabId){alert('Fill all');return}const lin=lcm/2.54;const hin=hcm/2.54;const sq=(lin*hin)/144;const value=sq*rate;try{const{data:rawSlab}=await supabaseClient.from('slabs').select('*').eq('id',rawSlabId).single();const{error:insertError}=await supabaseClient.from('slabs').insert([{block_id:rawSlab.block_id,slab_number:rawSlab.slab_number,status:'POLISHED',length:lin.toFixed(2),height:hin.toFixed(2),length_cm:lcm,height_cm:hcm,sqft:sq.toFixed(2),thickness:rawSlab.thickness,rate:rate,value:value.toFixed(0)}]);if(insertError)throw insertError;await supabaseClient.from('slabs').delete().eq('id',rawSlabId);document.getElementById('p_l_cm').value='';document.getElementById('p_h_cm').value='';document.getElementById('p_l_in').innerText='0';document.getElementById('p_h_in').innerText='0';await refreshData();alert('Polished!')}catch(error){alert('Error: '+error.message)}}function updateSaleFields(){const select=document.getElementById('sale_slab_list');const selected=select.options[select.selectedIndex];document.getElementById('sale_original_sqft').value=selected.getAttribute('data-sqft')||'';document.getElementById('sale_length_cm').value=selected.getAttribute('data-lcm')||'';document.getElementById('sale_height_cm').value=selected.getAttribute('data-hcm')||'';document.getElementById('sale_thickness').value=selected.getAttribute('data-thick')||'';updateSaleSummary()}function updateSaleSummary(){const original=parseFloat(document.getElementById('sale_original_sqft').value)||0;const sold=parseFloat(document.getElementById('sale_sold_sqft').value)||0;const price=parseFloat(document.getElementById('sale_price_sqft').value)||0;if(original&&sold&&price){const shrinkage=original-sold;const totalValue=sold*price;const shrinkPercent=(shrinkage/original*100).toFixed(1);document.getElementById('sale_summary').innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;font-size:13px"><div><div style="color:var(--text-secondary)">Shrinkage</div><div style="color:var(--red);font-weight:700">${shrinkage.toFixed(2)} sqft (${shrinkPercent}%)</div></div><div><div style="color:var(--text-secondary)">Total</div><div style="color:var(--neon);font-weight:700">Rs. ${totalValue.toLocaleString('en-IN')}</div></div></div>`}}async function recordSale(){if(!supabaseClient)return;const slabId=document.getElementById('sale_slab_list').value;const customer=document.getElementById('sale_customer').value.trim();const originalSqft=parseFloat(document.getElementById('sale_original_sqft').value);const soldSqft=parseFloat(document.getElementById('sale_sold_sqft').value);const priceSqft=parseFloat(document.getElementById('sale_price_sqft').value);const lengthCm=parseFloat(document.getElementById('sale_length_cm').value);const heightCm=parseFloat(document.getElementById('sale_height_cm').value);if(!slabId||!customer||!soldSqft||!priceSqft){alert('Fill all');return}const shrinkage=originalSqft-soldSqft;const totalValue=soldSqft*priceSqft;try{const{data:slab}=await supabaseClient.from('slabs').select('block_id, slab_number').eq('id',slabId).single();const lotId=slab.block_id.split('-')[0];const{error}=await supabaseClient.from('sales').insert([{slab_id:parseInt(slabId),lot_id:lotId,block_id:slab.block_id,slab_number:slab.slab_number,customer_name:customer,original_sqft:originalSqft,sold_sqft:soldSqft,price_per_sqft:priceSqft,total_value:totalValue,shrinkage_sqft:shrinkage,length_cm:lengthCm,height_cm:heightCm}]);if(error)throw error;document.getElementById('sale_slab_list').selectedIndex=0;document.getElementById('sale_customer').value='';document.getElementById('sale_original_sqft').value='';document.getElementById('sale_sold_sqft').value='';document.getElementById('sale_price_sqft').value='';document.getElementById('sale_length_cm').value='';document.getElementById('sale_height_cm').value='';document.getElementById('sale_thickness').value='';document.getElementById('sale_summary').innerHTML='Fill details';await refreshData();alert('Sale recorded!')}catch(error){alert('Error: '+error.message)}}function calculateWasteValue(){const weight=parseFloat(document.getElementById('waste_weight').value)||0;const price=parseFloat(document.getElementById('waste_price').value)||0;const total=weight*price;document.getElementById('waste_total').innerText='Total: Rs. '+total.toLocaleString('en-IN')}async function saveWasteSale(){if(!supabaseClient)return;const date=document.getElementById('waste_date').value;const desc=document.getElementById('waste_desc').value.trim();const weight=parseFloat(document.getElementById('waste_weight').value);const price=parseFloat(document.getElementById('waste_price').value);const buyer=document.getElementById('waste_buyer').value.trim();if(!date||!weight||!price){alert('Fill required fields');return}const total=weight*price;try{const{error}=await supabaseClient.from('waste_sales').insert([{sale_date:date,description:desc,weight_kg:weight,price_per_kg:price,total_value:total,buyer_name:buyer}]);if(error)throw error;document.getElementById('waste_date').value='';document.getElementById('waste_desc').value='';document.getElementById('waste_weight').value='';document.getElementById('waste_price').value='';document.getElementById('waste_buyer').value='';document.getElementById('waste_total').innerText='Total: Rs. 0';await refreshData();alert('Waste sale recorded!')}catch(error){alert('Error: '+error.message)}}async function completeBlock(lotId,blockId){if(!supabaseClient)return;if(!confirm(`Complete block "${lotId}-${blockId}"?`))return;try{await supabaseClient.from('blocks').update({status:'COMPLETED'}).eq('lot_id',lotId).eq('block_id',blockId);const{data:lotBlocks}=await supabaseClient.from('blocks').select('status').eq('lot_id',lotId);const allCompleted=lotBlocks.every(b=>b.status==='COMPLETED');if(allCompleted){await supabaseClient.from('lots').update({status:'COMPLETED'}).eq('lot_id',lotId);alert(`Block complete! Lot "${lotId}" also completed.`)}else{alert('Block completed!')}await refreshData()}catch(error){alert('Error: '+error.message)}}async function completeLot(lotId){if(!supabaseClient)return;if(!confirm(`Complete lot "${lotId}"?`))return;try{await supabaseClient.from('lots').update({status:'COMPLETED'}).eq('lot_id',lotId);alert('Lot completed!');await refreshData()}catch(error){alert('Error: '+error.message)}}function loadQualityGrades(){const grades=JSON.parse(localStorage.getItem('quality_grades')||JSON.stringify([{name:'Premium 2cm',rate:150,thickness:'2cm'},{name:'Premium 3cm',rate:200,thickness:'3cm'},{name:'Standard 2cm',rate:100,thickness:'2cm'},{name:'Standard 3cm',rate:130,thickness:'3cm'},{name:'Commercial',rate:75,thickness:'2cm'}]));const select=document.getElementById('p_q');if(select){select.innerHTML=grades.map(g=>`<option value="${g.rate}" data-thickness="${g.thickness}">${g.name} (Rs. ${g.rate}/sqft)</option>`).join('')}}async function refreshUsers(){if(!supabaseClient)return;try{const{data:users}=await supabaseClient.from('users').select('*');let usersHtml='<table class="inventory-table"><tr><th>Username</th><th>Role</th><th>Action</th></tr>';(users||[]).forEach(user=>{usersHtml+=`<tr><td>${user.username}</td><td>${user.role}</td><td><button onclick="changePassword('${user.username}')" style="background:var(--blue);border:none;padding:6px 12px;border-radius:4px;color:#000;cursor:pointer;font-size:11px;font-weight:700">Change PW</button></td></tr>`});usersHtml+='</table>';document.getElementById('users_list').innerHTML=usersHtml}catch(error){alert('Error: '+error.message)}}async function addUser(){if(!supabaseClient)return;const username=document.getElementById('new_username').value.trim();const password=document.getElementById('new_password').value.trim();const role=document.getElementById('new_role').value;if(!username||!password){alert('Fill all');return}try{const{error}=await supabaseClient.from('users').insert([{username,password,role}]);if(error)throw error;document.getElementById('new_username').value='';document.getElementById('new_password').value='';alert('User added!');refreshUsers()}catch(error){alert('Error: '+error.message)}}async function changePassword(username){const newPass=prompt(`New password for ${username}:`);if(!newPass)return;try{await supabaseClient.from('users').update({password:newPass}).eq('username',username);alert(`Password updated for ${username}!`)}catch(error){alert('Error: '+error.message)}}
</script>
</body>
</html>
